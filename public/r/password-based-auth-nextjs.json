{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "password-based-auth-nextjs",
  "title": "Password-Based Authentication (Next.js)",
  "description": "Complete password-based authentication flow for Next.js with Convex Auth. Includes login, sign-up, password reset, protected routes, and full Convex backend.",
  "dependencies": ["lucide-react", "@convex-dev/auth@latest", "convex@latest"],
  "registryDependencies": [
    "button",
    "input",
    "label",
    "card",
    "alert",
    "avatar",
    "skeleton"
  ],
  "files": [
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/components/login-form.tsx",
      "content": "\"use client\";\n\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport { Loader2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useState } from \"react\";\n\nexport function LoginForm() {\n  const { signIn } = useAuthActions();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.set(\"email\", email);\n      formData.set(\"password\", password);\n      formData.set(\"flow\", \"signIn\");\n\n      await signIn(\"password\", formData);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to sign in\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader>\n        <CardTitle>Welcome back</CardTitle>\n        <CardDescription>Sign in to your account to continue</CardDescription>\n      </CardHeader>\n      <form onSubmit={handleSubmit}>\n        <CardContent className=\"space-y-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"you@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"password\">Password</Label>\n              <Link\n                href=\"/auth/forgot-password\"\n                className=\"text-sm text-muted-foreground hover:text-primary\"\n              >\n                Forgot password?\n              </Link>\n            </div>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex flex-col gap-4\">\n          <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Sign in\n          </Button>\n          <p className=\"text-sm text-muted-foreground\">\n            Don't have an account?{\" \"}\n            <Link href=\"/auth/sign-up\" className=\"text-primary hover:underline\">\n              Sign up\n            </Link>\n          </p>\n        </CardFooter>\n      </form>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/components/sign-up-form.tsx",
      "content": "\"use client\";\n\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport { Loader2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function SignUpForm() {\n  const { signIn } = useAuthActions();\n  const router = useRouter();\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (password !== confirmPassword) {\n      setError(\"Passwords do not match\");\n      return;\n    }\n\n    if (password.length < 8) {\n      setError(\"Password must be at least 8 characters\");\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.set(\"name\", name);\n      formData.set(\"email\", email);\n      formData.set(\"password\", password);\n      formData.set(\"flow\", \"signUp\");\n\n      await signIn(\"password\", formData);\n      router.push(\"/auth/sign-up-success\");\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to create account\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader>\n        <CardTitle>Create an account</CardTitle>\n        <CardDescription>Enter your details to get started</CardDescription>\n      </CardHeader>\n      <form onSubmit={handleSubmit}>\n        <CardContent className=\"space-y-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"name\">Name</Label>\n            <Input\n              id=\"name\"\n              type=\"text\"\n              placeholder=\"John Doe\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"you@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Password</Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n            <Input\n              id=\"confirmPassword\"\n              type=\"password\"\n              value={confirmPassword}\n              onChange={(e) => setConfirmPassword(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex flex-col gap-4\">\n          <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Create account\n          </Button>\n          <p className=\"text-sm text-muted-foreground\">\n            Already have an account?{\" \"}\n            <Link href=\"/auth/login\" className=\"text-primary hover:underline\">\n              Sign in\n            </Link>\n          </p>\n        </CardFooter>\n      </form>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/components/forgot-password-form.tsx",
      "content": "\"use client\";\n\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { ArrowLeft, CheckCircle, Loader2 } from \"lucide-react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport Link from \"next/link\";\nimport { useState } from \"react\";\n\nexport function ForgotPasswordForm() {\n  const { signIn } = useAuthActions();\n  const [email, setEmail] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.set(\"email\", email);\n      formData.set(\"flow\", \"reset\");\n\n      await signIn(\"password\", formData);\n      setSuccess(true);\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : \"Failed to send reset email\",\n      );\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (success) {\n    return (\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <div className=\"flex items-center justify-center mb-4\">\n            <CheckCircle className=\"h-12 w-12 text-green-500\" />\n          </div>\n          <CardTitle className=\"text-center\">Check your email</CardTitle>\n          <CardDescription className=\"text-center\">\n            We've sent a password reset link to {email}\n          </CardDescription>\n        </CardHeader>\n        <CardFooter>\n          <Link href=\"/auth/login\" className=\"w-full\">\n            <Button variant=\"outline\" className=\"w-full\">\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to login\n            </Button>\n          </Link>\n        </CardFooter>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader>\n        <CardTitle>Reset your password</CardTitle>\n        <CardDescription>\n          Enter your email and we'll send you a link to reset your password\n        </CardDescription>\n      </CardHeader>\n      <form onSubmit={handleSubmit}>\n        <CardContent className=\"space-y-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"you@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex flex-col gap-4\">\n          <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Send reset link\n          </Button>\n          <Link href=\"/auth/login\" className=\"w-full\">\n            <Button variant=\"ghost\" className=\"w-full\">\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to login\n            </Button>\n          </Link>\n        </CardFooter>\n      </form>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/components/update-password-form.tsx",
      "content": "\"use client\";\n\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport { Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport function UpdatePasswordForm() {\n  const { signIn } = useAuthActions();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const token = searchParams.get(\"token\");\n\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (password !== confirmPassword) {\n      setError(\"Passwords do not match\");\n      return;\n    }\n\n    if (password.length < 8) {\n      setError(\"Password must be at least 8 characters\");\n      return;\n    }\n\n    if (!token) {\n      setError(\"Invalid reset token\");\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.set(\"token\", token);\n      formData.set(\"newPassword\", password);\n      formData.set(\"flow\", \"reset-verification\");\n\n      await signIn(\"password\", formData);\n      router.push(\"/auth/login?message=password-updated\");\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : \"Failed to update password\",\n      );\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!token) {\n    return (\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle>Invalid Link</CardTitle>\n          <CardDescription>\n            This password reset link is invalid or has expired.\n          </CardDescription>\n        </CardHeader>\n        <CardFooter>\n          <Button\n            onClick={() => router.push(\"/auth/forgot-password\")}\n            className=\"w-full\"\n          >\n            Request new link\n          </Button>\n        </CardFooter>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader>\n        <CardTitle>Set new password</CardTitle>\n        <CardDescription>Enter your new password below</CardDescription>\n      </CardHeader>\n      <form onSubmit={handleSubmit}>\n        <CardContent className=\"space-y-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">New Password</Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"confirmPassword\">Confirm New Password</Label>\n            <Input\n              id=\"confirmPassword\"\n              type=\"password\"\n              value={confirmPassword}\n              onChange={(e) => setConfirmPassword(e.target.value)}\n              required\n              disabled={loading}\n            />\n          </div>\n        </CardContent>\n        <CardFooter>\n          <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Update password\n          </Button>\n        </CardFooter>\n      </form>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/components/logout-button.tsx",
      "content": "\"use client\";\n\nimport { Button, type ButtonProps } from \"@/components/ui/button\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport { LogOut } from \"lucide-react\";\n\ninterface LogoutButtonProps extends ButtonProps {\n  showIcon?: boolean;\n}\n\nexport function LogoutButton({\n  showIcon = true,\n  children,\n  ...props\n}: LogoutButtonProps) {\n  const { signOut } = useAuthActions();\n\n  return (\n    <Button onClick={() => signOut()} {...props}>\n      {showIcon && <LogOut className=\"mr-2 h-4 w-4\" />}\n      {children ?? \"Sign out\"}\n    </Button>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/auth/login/page.tsx",
      "content": "import { LoginForm } from \"@/components/login-form\";\n\nexport default function LoginPage() {\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <LoginForm />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/auth/login/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/auth/sign-up/page.tsx",
      "content": "import { SignUpForm } from \"@/components/sign-up-form\";\n\nexport default function SignUpPage() {\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <SignUpForm />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/auth/sign-up/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/auth/forgot-password/page.tsx",
      "content": "import { ForgotPasswordForm } from \"@/components/forgot-password-form\";\n\nexport default function ForgotPasswordPage() {\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <ForgotPasswordForm />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/auth/forgot-password/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/auth/update-password/page.tsx",
      "content": "import { Suspense } from \"react\";\nimport { UpdatePasswordForm } from \"@/components/update-password-form\";\n\nexport default function UpdatePasswordPage() {\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <Suspense fallback={<div>Loading...</div>}>\n        <UpdatePasswordForm />\n      </Suspense>\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/auth/update-password/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/auth/sign-up-success/page.tsx",
      "content": "import {\n  Card,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle } from \"lucide-react\";\nimport Link from \"next/link\";\n\nexport default function SignUpSuccessPage() {\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <CheckCircle className=\"h-12 w-12 text-green-500\" />\n          </div>\n          <CardTitle>Account created!</CardTitle>\n          <CardDescription>\n            Your account has been successfully created. You can now sign in with\n            your credentials.\n          </CardDescription>\n        </CardHeader>\n        <CardFooter>\n          <Link href=\"/auth/login\" className=\"w-full\">\n            <Button className=\"w-full\">Continue to login</Button>\n          </Link>\n        </CardFooter>\n      </Card>\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/auth/sign-up-success/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/app/protected/page.tsx",
      "content": "\"use client\";\n\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nimport { LogoutButton } from \"@/components/logout-button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { api } from \"@/convex/_generated/api\";\nimport { useQuery } from \"convex/react\";\n\nexport default function ProtectedPage() {\n  const user = useQuery(api.users.current);\n\n  if (user === undefined) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <Skeleton className=\"h-8 w-48\" />\n            <Skeleton className=\"h-4 w-64\" />\n          </CardHeader>\n          <CardContent>\n            <Skeleton className=\"h-20 w-full\" />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>Not authenticated</CardTitle>\n            <CardDescription>Please sign in to view this page.</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle>Protected Page</CardTitle>\n          <CardDescription>\n            You are signed in and can view this content.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center gap-4\">\n            <Avatar className=\"h-16 w-16\">\n              <AvatarImage src={user.image} alt={user.name ?? \"User\"} />\n              <AvatarFallback>\n                {(user.name ?? \"U\").slice(0, 2).toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n            <div>\n              <p className=\"font-semibold\">{user.name ?? \"Anonymous\"}</p>\n              <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n            </div>\n          </div>\n          <LogoutButton variant=\"outline\" className=\"w-full\" />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "src/app/protected/page.tsx"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/convex/schema.ts",
      "content": "import { defineSchema, defineTable } from \"convex/server\";\nimport { authTables } from \"@convex-dev/auth/server\";\nimport { v } from \"convex/values\";\n\n/**\n * Schema for password-based authentication.\n * Includes the users table and all required auth tables from @convex-dev/auth.\n *\n * Security considerations:\n * - Email is indexed for fast lookups but never exposed in public queries\n * - emailVerificationTime tracks when email was verified\n * - isAnonymous flag supports gradual account upgrades\n */\nexport default defineSchema({\n  // Auth tables from @convex-dev/auth (authAccounts, authSessions, authVerificationCodes, etc.)\n  ...authTables,\n\n  // Users table with profile information\n  users: defineTable({\n    // Profile fields\n    name: v.optional(v.string()),\n    email: v.optional(v.string()),\n    image: v.optional(v.string()),\n\n    // Auth metadata\n    emailVerificationTime: v.optional(v.number()),\n    isAnonymous: v.optional(v.boolean()),\n  })\n    .index(\"by_email\", [\"email\"])\n    .index(\"by_anonymous\", [\"isAnonymous\"]),\n});\n",
      "type": "registry:file",
      "target": "convex/schema.ts"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/convex/auth.ts",
      "content": "import { convexAuth } from \"@convex-dev/auth/server\";\nimport { Password } from \"@convex-dev/auth/providers/Password\";\n\n/**\n * Convex Auth configuration for password-based authentication.\n *\n * Security features:\n * - Password provider with built-in hashing (bcrypt)\n * - Email verification support\n * - Password reset flow\n * - Secure session management\n *\n * To enable email verification, configure RESEND_API_KEY or another email provider.\n */\nexport const { auth, signIn, signOut, store } = convexAuth({\n  providers: [Password],\n  callbacks: {\n    /**\n     * Called when a user signs in or signs up.\n     * Creates the user record if it doesn't exist.\n     */\n    async createOrUpdateUser(ctx: any, args: any) {\n      if (args.existingUserId) {\n        // Existing user - optionally update profile from provider\n        const user = await ctx.db.get(args.existingUserId);\n        if (user && args.profile) {\n          // Update name/image if provided by OAuth (not applicable for Password)\n          const updates: any = {};\n          if (args.profile.name && !user.name) {\n            updates.name = args.profile.name;\n          }\n          if (args.profile.image && !user.image) {\n            updates.image = args.profile.image;\n          }\n          if (Object.keys(updates).length > 0) {\n            await ctx.db.patch(args.existingUserId, updates);\n          }\n        }\n        return args.existingUserId;\n      }\n\n      // Create new user\n      const userId = await ctx.db.insert(\"users\", {\n        name: args.profile?.name,\n        email: args.profile?.email,\n        image: args.profile?.image,\n        emailVerificationTime: args.profile?.emailVerified\n          ? Date.now()\n          : undefined,\n        isAnonymous: false,\n      });\n\n      return userId;\n    },\n  },\n});\n",
      "type": "registry:file",
      "target": "convex/auth.ts"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/convex/auth.config.ts",
      "content": "/**\n * Auth configuration for Convex Auth.\n *\n * The domain should match your Convex deployment URL.\n * This is automatically set via CONVEX_SITE_URL environment variable.\n */\nexport default {\n  providers: [\n    {\n      domain: process.env.CONVEX_SITE_URL,\n      applicationID: \"convex\",\n    },\n  ],\n};\n",
      "type": "registry:file",
      "target": "convex/auth.config.ts"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/convex/users.ts",
      "content": "import { query, mutation } from \"./_generated/server\";\nimport { v } from \"convex/values\";\nimport { getAuthUserId } from \"@convex-dev/auth/server\";\nimport { ConvexError } from \"convex/values\";\n\n/**\n * User validator for internal use.\n * Includes all fields - use publicProfileValidator for external queries.\n */\nconst userValidator = v.object({\n  _id: v.id(\"users\"),\n  _creationTime: v.number(),\n  name: v.optional(v.string()),\n  email: v.optional(v.string()),\n  image: v.optional(v.string()),\n  emailVerificationTime: v.optional(v.number()),\n  isAnonymous: v.optional(v.boolean()),\n});\n\n/**\n * Public profile validator - excludes sensitive fields like email.\n * Use this when returning user data to other users.\n */\nconst publicProfileValidator = v.object({\n  _id: v.id(\"users\"),\n  name: v.optional(v.string()),\n  image: v.optional(v.string()),\n});\n\n/**\n * Get the current authenticated user's full profile.\n * Returns null if not authenticated.\n *\n * Security: Only returns data for the authenticated user themselves.\n */\nexport const current = query({\n  args: {},\n  returns: v.union(userValidator, v.null()),\n  handler: async (ctx: any) => {\n    const userId = await getAuthUserId(ctx);\n    if (!userId) {\n      return null;\n    }\n    return await ctx.db.get(userId);\n  },\n});\n\n/**\n * Get a user's public profile by ID.\n * Only returns safe, public fields (name, image).\n *\n * Security: Never exposes email or other sensitive data.\n */\nexport const get = query({\n  args: { userId: v.id(\"users\") },\n  returns: v.union(publicProfileValidator, v.null()),\n  handler: async (ctx: any, args: any) => {\n    const user = await ctx.db.get(args.userId);\n    if (!user) {\n      return null;\n    }\n    // Only return public fields\n    return {\n      _id: user._id,\n      name: user.name,\n      image: user.image,\n    };\n  },\n});\n\n/**\n * Update the current user's profile.\n * Only allows updating safe fields (name, image).\n *\n * Security:\n * - Requires authentication\n * - Only allows updating own profile\n * - Validates input types\n */\nexport const updateProfile = mutation({\n  args: {\n    name: v.optional(v.string()),\n    image: v.optional(v.string()),\n  },\n  returns: v.null(),\n  handler: async (ctx: any, args: any) => {\n    const userId = await getAuthUserId(ctx);\n    if (!userId) {\n      throw new ConvexError({\n        code: \"UNAUTHORIZED\",\n        message: \"You must be logged in to update your profile\",\n      });\n    }\n\n    // Build updates object with only provided fields\n    const updates: any = {};\n    if (args.name !== undefined) {\n      // Sanitize name - trim whitespace, limit length\n      const sanitizedName = args.name.trim().slice(0, 100);\n      if (sanitizedName) {\n        updates.name = sanitizedName;\n      }\n    }\n    if (args.image !== undefined) {\n      // Validate image URL format\n      if (args.image && !isValidUrl(args.image)) {\n        throw new ConvexError({\n          code: \"INVALID_INPUT\",\n          message: \"Invalid image URL\",\n        });\n      }\n      updates.image = args.image;\n    }\n\n    if (Object.keys(updates).length > 0) {\n      await ctx.db.patch(userId, updates);\n    }\n\n    return null;\n  },\n});\n\n/**\n * Helper to validate URL format.\n */\nfunction isValidUrl(string: string): boolean {\n  try {\n    const url = new URL(string);\n    return url.protocol === \"http:\" || url.protocol === \"https:\";\n  } catch {\n    return false;\n  }\n}\n",
      "type": "registry:file",
      "target": "convex/users.ts"
    },
    {
      "path": "src/registry/convex/blocks/password-based-auth-nextjs/convex/http.ts",
      "content": "import { httpRouter } from \"convex/server\";\nimport { auth } from \"./auth\";\n\n/**\n * HTTP router for Convex Auth.\n *\n * This sets up the required HTTP endpoints for authentication:\n * - POST /api/auth/signin - Sign in\n * - POST /api/auth/signout - Sign out\n * - GET /api/auth/signin/* - OAuth callbacks\n * - POST /api/auth/callback/* - OAuth callbacks\n *\n * These routes are automatically configured by auth.addHttpRoutes().\n */\nconst http = httpRouter();\n\n// Add all auth HTTP routes\nauth.addHttpRoutes(http);\n\nexport default http;\n",
      "type": "registry:file",
      "target": "convex/http.ts"
    },
    {
      "path": "src/registry/convex/clients/nextjs/lib/convex/client.ts",
      "content": "\"use client\";\n\nimport { ConvexReactClient } from \"convex/react\";\n\nconst convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL!;\n\nexport const convex = new ConvexReactClient(convexUrl);\n",
      "type": "registry:lib"
    },
    {
      "path": "src/registry/convex/clients/nextjs/lib/convex/provider.tsx",
      "content": "\"use client\";\n\nimport { ConvexAuthNextjsProvider } from \"@convex-dev/auth/nextjs\";\nimport { ConvexReactClient } from \"convex/react\";\nimport { ReactNode } from \"react\";\n\nconst convex = new ConvexReactClient(process.env.NEXT_PUBLIC_CONVEX_URL!);\n\nexport function ConvexClientProvider({ children }: { children: ReactNode }) {\n  return (\n    <ConvexAuthNextjsProvider client={convex}>\n      {children}\n    </ConvexAuthNextjsProvider>\n  );\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "src/registry/convex/clients/nextjs/lib/convex/server.ts",
      "content": "import {\n  fetchQuery,\n  fetchMutation,\n  fetchAction,\n  preloadQuery,\n} from \"convex/nextjs\";\nimport { api } from \"@/convex/_generated/api\";\n\nexport { fetchQuery, fetchMutation, fetchAction, preloadQuery, api };\n",
      "type": "registry:lib"
    },
    {
      "path": "src/registry/convex/clients/nextjs/proxy.ts",
      "content": "import {\n  convexAuthNextjsMiddleware,\n  createRouteMatcher,\n} from \"@convex-dev/auth/nextjs/server\";\n\nconst isProtectedRoute = createRouteMatcher([\"/protected(.*)\"]);\n\n// Named export for Next.js 16+ (proxy.ts)\nexport const proxy = convexAuthNextjsMiddleware((request, { convexAuth }) => {\n  if (isProtectedRoute(request) && !convexAuth.isAuthenticated()) {\n    return Response.redirect(new URL(\"/auth/login\", request.url));\n  }\n});\n\nexport const config = {\n  matcher: [\"/((?!.*\\\\..*|_next).*)\", \"/\", \"/(api|trpc)(.*)\"],\n};\n",
      "type": "registry:lib",
      "target": "src/proxy.ts"
    }
  ],
  "envVars": {
    "CONVEX_DEPLOYMENT": "",
    "NEXT_PUBLIC_CONVEX_URL": ""
  },
  "docs": "You'll need to set the following environment variable in your project: `NEXT_PUBLIC_CONVEX_URL`. Run `npx convex dev` to get your Convex deployment URL.",
  "type": "registry:block"
}
