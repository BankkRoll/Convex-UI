{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "social-auth-react",
  "title": "Social Authentication (React)",
  "description": "Social authentication (OAuth) components for React with Convex Auth. Supports GitHub and Google sign-in with full Convex backend.",
  "dependencies": [
    "lucide-react",
    "@convex-dev/auth@latest",
    "convex@latest",
    "@auth/core"
  ],
  "registryDependencies": [
    "button",
    "card",
    "alert"
  ],
  "files": [
    {
      "path": "src/registry/convex/blocks/social-auth-react/components/login-form.tsx",
      "content": "\"use client\";\n\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { useAuthActions } from \"@convex-dev/auth/react\";\nimport { Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\n\nfunction GitHubIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\" />\n    </svg>\n  );\n}\n\nfunction GoogleIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" />\n      <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" />\n      <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" />\n      <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" />\n    </svg>\n  );\n}\n\ntype Provider = \"github\" | \"google\";\n\ninterface SocialLoginFormProps {\n  providers?: Provider[];\n}\n\nexport function SocialLoginForm({\n  providers = [\"github\", \"google\"],\n}: SocialLoginFormProps) {\n  const { signIn } = useAuthActions();\n  const [error, setError] = useState<string | null>(null);\n  const [loadingProvider, setLoadingProvider] = useState<Provider | null>(null);\n\n  const handleSocialLogin = async (provider: Provider) => {\n    setError(null);\n    setLoadingProvider(provider);\n\n    try {\n      await signIn(provider);\n    } catch (err) {\n      setError(\n        err instanceof Error\n          ? err.message\n          : `Failed to sign in with ${provider}`,\n      );\n      setLoadingProvider(null);\n    }\n  };\n\n  const providerConfig = {\n    github: {\n      name: \"GitHub\",\n      icon: GitHubIcon,\n    },\n    google: {\n      name: \"Google\",\n      icon: GoogleIcon,\n    },\n  };\n\n  return (\n    <Card className=\"w-full max-w-md shadow-lg\">\n      <CardHeader className=\"space-y-1 pb-6\">\n        <CardTitle className=\"text-2xl text-center\">Welcome</CardTitle>\n        <CardDescription className=\"text-center\">\n          Sign in with your social account\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4 pb-6\">\n        {error && (\n          <Alert\n            variant=\"destructive\"\n            className=\"animate-in fade-in-0 slide-in-from-top-1 duration-300\"\n          >\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        )}\n        <div className=\"grid gap-3\">\n          {providers.map((provider) => {\n            const config = providerConfig[provider];\n            const Icon = config.icon;\n            const isLoading = loadingProvider === provider;\n\n            return (\n              <Button\n                key={provider}\n                variant=\"outline\"\n                size=\"lg\"\n                className=\"w-full transition-all hover:bg-accent hover:scale-[1.02]\"\n                onClick={() => handleSocialLogin(provider)}\n                disabled={loadingProvider !== null}\n              >\n                {isLoading ? (\n                  <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                ) : (\n                  <Icon className=\"mr-2 h-5 w-5\" />\n                )}\n                Continue with {config.name}\n              </Button>\n            );\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/convex/blocks/social-auth-react/convex/schema.ts",
      "content": "import { defineSchema, defineTable } from \"convex/server\";\nimport { authTables } from \"@convex-dev/auth/server\";\nimport { v } from \"convex/values\";\n\n/**\n * Schema for social (OAuth) authentication.\n * Includes the users table and all required auth tables from @convex-dev/auth.\n *\n * Security considerations:\n * - Email is indexed for fast lookups but never exposed in public queries\n * - emailVerificationTime is set when OAuth provider verifies email\n * - Profile data (name, image) is populated from OAuth provider\n */\nexport default defineSchema({\n  // Auth tables from @convex-dev/auth (authAccounts, authSessions, etc.)\n  ...authTables,\n\n  // Users table with profile information from OAuth providers\n  users: defineTable({\n    // Profile fields (populated from OAuth provider)\n    name: v.optional(v.string()),\n    email: v.optional(v.string()),\n    image: v.optional(v.string()),\n\n    // Auth metadata\n    emailVerificationTime: v.optional(v.number()),\n    isAnonymous: v.optional(v.boolean()),\n  })\n    .index(\"by_email\", [\"email\"])\n    .index(\"by_anonymous\", [\"isAnonymous\"]),\n});\n",
      "type": "registry:file",
      "target": "convex/schema.ts"
    },
    {
      "path": "src/registry/convex/blocks/social-auth-react/convex/auth.ts",
      "content": "import { convexAuth } from \"@convex-dev/auth/server\";\nimport GitHub from \"@auth/core/providers/github\";\nimport Google from \"@auth/core/providers/google\";\n\n// Build providers list dynamically based on available env vars\nconst providers: Parameters<typeof convexAuth>[0][\"providers\"] = [];\n\n// Only add GitHub if credentials are configured\nif (process.env.AUTH_GITHUB_ID && process.env.AUTH_GITHUB_SECRET) {\n  providers.push(GitHub);\n}\n\n// Only add Google if credentials are configured\nif (process.env.AUTH_GOOGLE_ID && process.env.AUTH_GOOGLE_SECRET) {\n  providers.push(Google);\n}\n\n// Fallback: if no providers configured, add both (they will fail gracefully at runtime)\nif (providers.length === 0) {\n  providers.push(GitHub, Google);\n}\n\n/**\n * Convex Auth configuration for social (OAuth) authentication.\n *\n * Features:\n * - GitHub OAuth (if AUTH_GITHUB_ID/SECRET configured)\n * - Google OAuth (if AUTH_GOOGLE_ID/SECRET configured)\n * - OAuth 2.0 with PKCE\n * - Automatic email verification from trusted providers\n * - Secure session management\n *\n * Environment variables:\n * - AUTH_GITHUB_ID, AUTH_GITHUB_SECRET: GitHub OAuth credentials\n * - AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET: Google OAuth credentials\n *\n * Callback URLs (configure in provider dashboard):\n * - GitHub: https://YOUR_CONVEX_URL/api/auth/callback/github\n * - Google: https://YOUR_CONVEX_URL/api/auth/callback/google\n */\nexport const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({\n  providers,\n  callbacks: {\n    /**\n     * Called when a user signs in via OAuth.\n     * Creates the user record if it doesn't exist, or updates profile data.\n     */\n    async createOrUpdateUser(ctx, args) {\n      if (args.existingUserId) {\n        // Existing user - update profile from OAuth provider if needed\n        const user = await ctx.db.get(args.existingUserId);\n        if (user && args.profile) {\n          const updates: {\n            name?: string;\n            image?: string;\n            emailVerificationTime?: number;\n          } = {};\n\n          // Update profile fields if provider has newer data\n          if (args.profile.name && args.profile.name !== user.name) {\n            updates.name = args.profile.name;\n          }\n          if (args.profile.image && args.profile.image !== user.image) {\n            updates.image = args.profile.image;\n          }\n          // Mark email as verified if provider verifies it\n          if (args.profile.emailVerified && !user.emailVerificationTime) {\n            updates.emailVerificationTime = Date.now();\n          }\n\n          if (Object.keys(updates).length > 0) {\n            await ctx.db.patch(args.existingUserId, updates);\n          }\n        }\n        return args.existingUserId;\n      }\n\n      // Create new user with profile from OAuth provider\n      const userId = await ctx.db.insert(\"users\", {\n        name: args.profile?.name,\n        email: args.profile?.email,\n        image: args.profile?.image,\n        // OAuth providers that verify email set emailVerified to true\n        emailVerificationTime: args.profile?.emailVerified\n          ? Date.now()\n          : undefined,\n        isAnonymous: false,\n      });\n\n      return userId;\n    },\n  },\n});\n",
      "type": "registry:file",
      "target": "convex/auth.ts"
    },
    {
      "path": "src/registry/convex/blocks/social-auth-react/convex/auth.config.ts",
      "content": "import { AuthConfig } from \"convex/server\";\n\n/**\n * Auth configuration for Convex Auth with OAuth providers.\n *\n * The domain should match your Convex deployment URL.\n * This is automatically set via CONVEX_SITE_URL environment variable.\n *\n * Required environment variables:\n * - CONVEX_SITE_URL: Your Convex deployment URL\n * - AUTH_GITHUB_ID, AUTH_GITHUB_SECRET: GitHub OAuth credentials\n * - AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET: Google OAuth credentials\n *\n * Configure the OAuth callback URLs in your provider's settings:\n * - GitHub: https://YOUR_CONVEX_URL/api/auth/callback/github\n * - Google: https://YOUR_CONVEX_URL/api/auth/callback/google\n */\nexport default {\n  providers: [\n    {\n      domain: process.env.CONVEX_SITE_URL!,\n      applicationID: \"convex\",\n    },\n  ],\n} satisfies AuthConfig;\n",
      "type": "registry:file",
      "target": "convex/auth.config.ts"
    },
    {
      "path": "src/registry/convex/blocks/social-auth-react/convex/users.ts",
      "content": "import { query, mutation } from \"./_generated/server\";\nimport { v } from \"convex/values\";\nimport { getAuthUserId } from \"@convex-dev/auth/server\";\nimport { ConvexError } from \"convex/values\";\n\n/**\n * User validator for internal use.\n * Includes all fields - use publicProfileValidator for external queries.\n */\nconst userValidator = v.object({\n  _id: v.id(\"users\"),\n  _creationTime: v.number(),\n  name: v.optional(v.string()),\n  email: v.optional(v.string()),\n  image: v.optional(v.string()),\n  emailVerificationTime: v.optional(v.number()),\n  isAnonymous: v.optional(v.boolean()),\n});\n\n/**\n * Public profile validator - excludes sensitive fields like email.\n * Use this when returning user data to other users.\n */\nconst publicProfileValidator = v.object({\n  _id: v.id(\"users\"),\n  name: v.optional(v.string()),\n  image: v.optional(v.string()),\n});\n\n/**\n * Get the current authenticated user's full profile.\n * Returns null if not authenticated.\n *\n * Security: Only returns data for the authenticated user themselves.\n */\nexport const current = query({\n  args: {},\n  returns: v.union(userValidator, v.null()),\n  handler: async (ctx: any) => {\n    const userId = await getAuthUserId(ctx);\n    if (!userId) {\n      return null;\n    }\n    return await ctx.db.get(userId);\n  },\n});\n\n/**\n * Get a user's public profile by ID.\n * Only returns safe, public fields (name, image).\n *\n * Security: Never exposes email or other sensitive data.\n */\nexport const get = query({\n  args: { userId: v.id(\"users\") },\n  returns: v.union(publicProfileValidator, v.null()),\n  handler: async (ctx: any, args: any) => {\n    const user = await ctx.db.get(args.userId);\n    if (!user) {\n      return null;\n    }\n    // Only return public fields\n    return {\n      _id: user._id,\n      name: user.name,\n      image: user.image,\n    };\n  },\n});\n\n/**\n * Update the current user's profile.\n * Only allows updating safe fields (name, image).\n *\n * Security:\n * - Requires authentication\n * - Only allows updating own profile\n * - Validates input types\n */\nexport const updateProfile = mutation({\n  args: {\n    name: v.optional(v.string()),\n    image: v.optional(v.string()),\n  },\n  returns: v.null(),\n  handler: async (ctx: any, args: any) => {\n    const userId = await getAuthUserId(ctx);\n    if (!userId) {\n      throw new ConvexError({\n        code: \"UNAUTHORIZED\",\n        message: \"You must be logged in to update your profile\",\n      });\n    }\n\n    // Build updates object with only provided fields\n    const updates: any = {};\n    if (args.name !== undefined) {\n      // Sanitize name - trim whitespace, limit length\n      const sanitizedName = args.name.trim().slice(0, 100);\n      if (sanitizedName) {\n        updates.name = sanitizedName;\n      }\n    }\n    if (args.image !== undefined) {\n      // Validate image URL format\n      if (args.image && !isValidUrl(args.image)) {\n        throw new ConvexError({\n          code: \"INVALID_INPUT\",\n          message: \"Invalid image URL\",\n        });\n      }\n      updates.image = args.image;\n    }\n\n    if (Object.keys(updates).length > 0) {\n      await ctx.db.patch(userId, updates);\n    }\n\n    return null;\n  },\n});\n\n/**\n * Helper to validate URL format.\n */\nfunction isValidUrl(string: string): boolean {\n  try {\n    const url = new URL(string);\n    return url.protocol === \"http:\" || url.protocol === \"https:\";\n  } catch {\n    return false;\n  }\n}\n",
      "type": "registry:file",
      "target": "convex/users.ts"
    },
    {
      "path": "src/registry/convex/blocks/social-auth-react/convex/http.ts",
      "content": "import { httpRouter } from \"convex/server\";\nimport { auth } from \"./auth\";\n\n/**\n * HTTP router for Convex Auth with OAuth providers.\n *\n * This sets up the required HTTP endpoints for authentication:\n * - GET /api/auth/signin/github - Initiate GitHub OAuth\n * - GET /api/auth/signin/google - Initiate Google OAuth\n * - GET /api/auth/callback/github - GitHub OAuth callback\n * - GET /api/auth/callback/google - Google OAuth callback\n * - POST /api/auth/signout - Sign out\n *\n * These routes are automatically configured by auth.addHttpRoutes().\n */\nconst http = httpRouter();\n\n// Add all auth HTTP routes\nauth.addHttpRoutes(http);\n\nexport default http;\n",
      "type": "registry:file",
      "target": "convex/http.ts"
    },
    {
      "path": "src/registry/convex/clients/react/lib/convex/client.ts",
      "content": "import { ConvexReactClient } from \"convex/react\";\n\nconst convexUrl = (import.meta as any).env.VITE_CONVEX_URL as string;\n\nexport const convex = new ConvexReactClient(convexUrl);\n",
      "type": "registry:lib"
    },
    {
      "path": "src/registry/convex/clients/react/lib/convex/provider.tsx",
      "content": "import { ConvexAuthProvider } from \"@convex-dev/auth/react\";\nimport { ConvexReactClient } from \"convex/react\";\nimport { ReactNode } from \"react\";\n\nconst convex = new ConvexReactClient(\n  (import.meta as any).env.VITE_CONVEX_URL as string,\n);\n\nexport function ConvexClientProvider({ children }: { children: ReactNode }) {\n  return <ConvexAuthProvider client={convex}>{children}</ConvexAuthProvider>;\n}\n",
      "type": "registry:lib"
    }
  ],
  "envVars": {
    "CONVEX_DEPLOYMENT": "",
    "VITE_CONVEX_URL": "",
    "AUTH_GITHUB_ID": "",
    "AUTH_GITHUB_SECRET": "",
    "AUTH_GOOGLE_ID": "",
    "AUTH_GOOGLE_SECRET": ""
  },
  "docs": "## Post-Install Setup\n\n1. Run `npx convex dev` to start the Convex dev server and get your deployment URL.\n\n2. Set environment variables in the Convex dashboard (Settings > Environment Variables):\n   - `AUTH_GITHUB_ID` / `AUTH_GITHUB_SECRET` - GitHub OAuth credentials\n   - `AUTH_GOOGLE_ID` / `AUTH_GOOGLE_SECRET` - Google OAuth credentials\n\n3. Configure OAuth callback URLs in each provider's dashboard:\n   - GitHub: `https://<your-convex-url>/api/auth/callback/github`\n   - Google: `https://<your-convex-url>/api/auth/callback/google`\n\nAt least one OAuth provider must be configured for authentication to work.\n\n## Post-Install Setup\n\n1. Run `npx convex dev` to start the Convex dev server and get your deployment URL.\n\n2. Copy the deployment URL to your `.env` file as `VITE_CONVEX_URL`.\n\n3. Wrap your app with the `ConvexAuthProvider` from `lib/convex/provider.tsx`.",
  "type": "registry:block"
}